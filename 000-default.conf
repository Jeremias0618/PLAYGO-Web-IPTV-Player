# PLAYGO Web IPTV Player - Apache2 VirtualHost Configuration
# For Ubuntu Server with Apache2
# 
# Installation instructions:
# 1. Copy this file to /etc/apache2/sites-available/playgo.conf
# 2. Enable the site: sudo a2ensite playgo.conf
# 3. Enable required modules: sudo a2enmod rewrite headers expires deflate mime
# 4. Reload Apache: sudo systemctl reload apache2
#
# Make sure to adjust DocumentRoot path to match your installation directory

<VirtualHost *:80>
    ServerName playgo.com
    ServerAlias www.playgo.com
    
    # Document root - Adjust this path to your actual installation
    # Default Ubuntu path: /var/www/html/PLAYGO-Web-IPTV-Player
    # Or use: /var/www/playgo
    DocumentRoot /var/www/html/PLAYGO-Web-IPTV-Player
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/playgo-error.log
    CustomLog ${APACHE_LOG_DIR}/playgo-access.log combined
    LogLevel warn
    
    # Main directory configuration
    <Directory /var/www/html/PLAYGO-Web-IPTV-Player>
        Options -Indexes +FollowSymLinks -MultiViews
        AllowOverride All
        Require all granted
        
        # Prevent access to hidden files
        <FilesMatch "^\.">
            Require all denied
        </FilesMatch>
    </Directory>
    
    # Protect sensitive configuration files
    <FilesMatch "^(config\.php|\.htaccess|\.git|\.gitignore|\.env)$">
        Require all denied
    </FilesMatch>
    
    # Protect libs/config.php specifically
    <FilesMatch "^config\.php$">
        <LocationMatch "^/libs/">
            Require all denied
        </LocationMatch>
    </FilesMatch>
    
    # Protect storage directory from direct access
    <Directory /var/www/html/PLAYGO-Web-IPTV-Player/storage>
        Require all denied
    </Directory>
    
    # Protect .git directory
    <DirectoryMatch "^/.*/\.git/">
        Require all denied
    </DirectoryMatch>
    
    # PHP configuration
    <FilesMatch \.php$>
        SetHandler application/x-httpd-php
    </FilesMatch>
    
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value max_execution_time 300
    php_value max_input_time 300
    php_value memory_limit 256M
    
    # Security headers
    <IfModule mod_headers.c>
        # Prevent clickjacking
        Header always set X-Frame-Options "SAMEORIGIN"
        
        # XSS Protection
        Header always set X-XSS-Protection "1; mode=block"
        
        # Prevent MIME type sniffing
        Header always set X-Content-Type-Options "nosniff"
        
        # Referrer Policy
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        
        # Content Security Policy (adjust as needed)
        Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdn.plyr.io; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:; media-src 'self' https:;"
        
        # Remove server signature
        Header unset Server
        Header unset X-Powered-By
    </IfModule>
    
    # Cache static assets
    <IfModule mod_expires.c>
        ExpiresActive On
        
        # Images
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/webp "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType image/x-icon "access plus 1 year"
        
        # CSS and JavaScript
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType text/javascript "access plus 1 month"
        
        # Fonts
        ExpiresByType font/woff2 "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/ttf "access plus 1 year"
        ExpiresByType font/otf "access plus 1 year"
        
        # Audio and video
        ExpiresByType audio/mpeg "access plus 1 month"
        ExpiresByType video/mp4 "access plus 1 month"
        
        # Default
        ExpiresDefault "access plus 1 week"
    </IfModule>
    
    # Compression for text files
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
        AddOutputFilterByType DEFLATE application/javascript application/x-javascript
        AddOutputFilterByType DEFLATE application/json application/xml
        AddOutputFilterByType DEFLATE image/svg+xml
    </IfModule>
    
    # MIME types for video streaming
    <IfModule mod_mime.c>
        AddType video/mp4 .mp4
        AddType video/webm .webm
        AddType video/ogg .ogv
        AddType application/vnd.apple.mpegurl .m3u8
        AddType video/mp2t .ts
        AddType application/x-mpegURL .m3u8
    </IfModule>
    
    # URL Rewriting for clean URLs
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteBase /
        
        # Force HTTPS (uncomment when SSL is configured)
        # RewriteCond %{HTTPS} off
        # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
        
        # Redirect www to non-www (or vice versa - adjust as needed)
        # RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
        # RewriteRule ^(.*)$ http://%1/$1 [R=301,L]
        
        # Prevent access to sensitive files
        RewriteRule ^(libs/config\.php|\.git|\.env|composer\.(json|lock))$ - [F,L]
        
        # Allow access to assets, scripts, and styles
        RewriteCond %{REQUEST_FILENAME} -f
        RewriteRule ^(assets|scripts|styles|webfonts|collection)/ - [L]
        
        # Allow access to API endpoints
        RewriteRule ^libs/endpoints/ - [L]
        
        # Default: serve PHP files normally
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^([^\.]+)$ $1.php [NC,L]
    </IfModule>
    
    # Directory index
    DirectoryIndex index.php index.html
    
    # Custom error pages (optional - create these files if needed)
    # ErrorDocument 404 /404.php
    # ErrorDocument 403 /403.php
    # ErrorDocument 500 /500.php
    
</VirtualHost>

# HTTPS Configuration (uncomment and configure when SSL certificate is available)
# 
# To enable HTTPS with Let's Encrypt:
# 1. Install certbot: sudo apt-get install certbot python3-certbot-apache
# 2. Get certificate: sudo certbot --apache -d playgo.com -d www.playgo.com
# 3. Certbot will automatically configure this section
#
# <VirtualHost *:443>
#     ServerName playgo.com
#     ServerAlias www.playgo.com
#     
#     DocumentRoot /var/www/html/PLAYGO-Web-IPTV-Player
#     
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/playgo.com/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/playgo.com/privkey.pem
#     SSLCertificateChainFile /etc/letsencrypt/live/playgo.com/chain.pem
#     
#     # Include all configurations from above
#     # ... (copy all Directory, FilesMatch, etc. blocks from port 80)
#     
#     # HSTS (HTTP Strict Transport Security)
#     <IfModule mod_headers.c>
#         Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
#     </IfModule>
#     
# </VirtualHost>
